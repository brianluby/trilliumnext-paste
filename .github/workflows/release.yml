name: Package Alfred Workflow

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  package:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Package workflow
      run: |
        cd "TrilliumNext Paste.alfredworkflow"
        zip -r "../TrilliumNext-Paste.alfredworkflow" *
        
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: TrilliumNext-Paste.alfredworkflow
        body: |
          ## Installation
          
          1. Download `TrilliumNext-Paste.alfredworkflow`
          2. Double-click to import into Alfred
          3. Configure your TrilliumNext URL and ETAPI token
          4. Use `tn` in Alfred to capture notes
          
          See the [README](https://github.com/brianluby/trilliumnext-paste/blob/main/README.md) for detailed instructions.
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
